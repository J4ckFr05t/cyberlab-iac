---
- name: Configure Domain Controller
  hosts: dc
  gather_facts: yes
  
  vars:
    # Connection variables - use provided credentials
    ansible_user: "{{ win_username }}"
    ansible_password: "{{ win_password }}"
  
  # Specify roles path relative to playbook location
  vars_files:
    - ../inventory/group_vars/dc.yml
    - ../inventory/group_vars/secret_vault.yml
  
  pre_tasks:
    # Display configuration summary
    - name: Display configuration summary
      debug:
        msg:
          - "Domain: {{ domain_name }}"
          - "NetBIOS: {{ domain_netbios_name }}"
          - "Target Host: {{ inventory_hostname }}"
      tags:
        - always
  
  roles:
    - role: ../roles/dc_setup
  
  post_tasks:
    # Final verification
    - name: Display completion message
      debug:
        msg:
          - "Domain Controller setup completed successfully!"
          - "Domain: {{ domain_name }}"
          - "Domain Controller: {{ inventory_hostname }}"
          - "OUs created: {{ organizational_units | map(attribute='name') | list | join(', ') }}"
          - "Users created: {{ domain_users | map(attribute='sam_account_name') | list | join(', ') }}"
      tags:
        - always
